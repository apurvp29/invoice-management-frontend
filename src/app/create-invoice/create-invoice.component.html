<div class="p-4 sm:ml-64">
  <div
    class="p-4 border-2 border-gray-200 border-dashed rounded-lg dark:border-gray-700 mt-14 flex flex-col items-center"
  >
    <div
      class="w-full xl:w-3/4 2xl:w-2/3 bg-white py-6 md:px-12 border border-gray-200 shadow rounded-lg"
    >
      <div class="text-center">
        <h1
          class="text-center text-4xl font-semibold border-b-2 border-black inline-block border-dashed mb-10"
        >
          Invoice
        </h1>
      </div>
      <div class="w-full lg:w-1/2 px-3">
        <div class="flex justify-between items-center md:pr-8 mb-3">
          <label for="invoice-number" class="">Invoice No.</label>
          <input
            type="text"
            id="invoice-number"
            class="w-1/2 border-b border-t-0 border-x-0 focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
            [readOnly]="currentInvoice"
            [(ngModel)]="invoiceNumber"
            (input)="checkValidInvoiceNumber()"
            [value]="currentInvoice ? currentInvoice.invoiceNumber : ''"
          />
        </div>
        <div *ngIf="showInvalidNumber" class="md:pr-8 flex justify-end mb-3">
          <span class="w-1/2 text-[12px] text-red-600 inline-block"
            >Invoice number already exists</span
          >
        </div>
        <div class="flex justify-between items-center md:pr-8 mb-3">
          <label for="invoice-date" class="">Invoice Date</label>
          <input
            type="date"
            id="invoice-date"
            class="w-1/2 border-b border-t-0 border-x-0 focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
            [(ngModel)]="invoiceDate"
            [value]="
              currentInvoice ? currentInvoice.invoiceDate.substring(0, 10) : ''
            "
            [readOnly]="viewOnly"
          />
        </div>
        <div class="flex justify-between items-center md:pr-8 mb-3">
          <label for="invoice-due-date" class="">Due Date</label>
          <input
            type="date"
            id="invoice-due-date"
            class="w-1/2 border-b border-t-0 border-x-0 focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
            [(ngModel)]="invoiceDueDate"
            [value]="
              currentInvoice ? currentInvoice.dueDate.substring(0, 10) : ''
            "
            [readOnly]="viewOnly"
          />
        </div>
      </div>
      <div class="flex flex-col lg:flex-row gap-2 w-full mt-14">
        <div class="w-full lg:w-1/2 p-6 bg-[#f7faff] rounded-[4px]">
          <span class="text-xl border-b border-dashed border-b-black pb-1"
            >Billed By</span
          >
          <select class="w-full rounded-[4px] mt-2 bg-[#f7faff]">
            <option>
              {{ businessObj?.name }}
            </option>
          </select>
          <div
            class="border border-gray-500 bg-white w-full min-h-36 mt-4 rounded-[4px] p-6"
          >
            <div *ngIf="businessObj">
              <span class="font-semibold block mb-3">Business details</span>
              <span class="text-sm block"
                >Business Name: {{ businessObj["name"] }}</span
              >
              <span class="text-sm block"
                >Email: {{ businessObj["email"] }}</span
              >
              <span class="text-sm block"
                >Phone: {{ businessObj["phone"] }}</span
              >
            </div>
          </div>
        </div>
        <div class="w-full lg:w-1/2 p-6 bg-[#f7faff] rounded-[4px]">
          <span class="text-xl border-b border-dashed border-b-black pb-1"
            >Billed To</span
          >
          <select
            class="w-full rounded-[4px] mt-2 bg-[#f7faff]"
            [(ngModel)]="selectedClient"
            (change)="onSelectClient()"
            [value]="currentInvoice ? currentInvoice.billedTo : ''"
            [disabled]="!!currentInvoice"
          >
            <option
              *ngFor="let client of allClients"
              value="{{ client['clientId'] }}"
            >
              {{ client["name"] }}
            </option>
          </select>
          <div
            class="border border-gray-500 bg-white w-full min-h-36 mt-4 rounded-[4px] p-6"
          >
            <div *ngIf="clientObj">
              <span class="font-semibold block mb-3">Client details</span>
              <span class="text-sm block"
                >Industry Name: {{ clientObj["industryName"] }}</span
              >
              <span class="text-sm block">Email: {{ clientObj["email"] }}</span>
              <span class="text-sm block">Phone: {{ clientObj["phone"] }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-10 bg-[#f7faff]">
        <div class="p-4 bg-[#16579D] flex gap-5">
          <span class="text-white font-semibold text-lg inline-block w-1/3"
            >Item</span
          >
          <span
            class="text-white font-semibold text-lg hidden lg:inline-block w-[15%]"
            >Quantity</span
          >
          <span
            class="text-white font-semibold text-lg hidden lg:inline-block w-[15%]"
            >Rate</span
          >
          <span
            class="text-white font-semibold text-lg hidden lg:inline-block w-[15%]"
            >Amount</span
          >
        </div>

        <ng-container *ngFor="let n of numSequence(numOfItems); let i = index">
          <div
            *ngIf="numOfItems > 0"
            class="p-4 pt-1 flex flex-col lg:flex-row gap-5 items-center w-full border border-gray-200 lg:border-0"
          >
            <span
              class="flex lg:inline justify-between w-full lg:w-1/3 items-center"
            >
              <label class="inline lg:hidden text-[15px] text-gray-700"
                >Item</label
              >
              <input
                type="text"
                name="item"
                class="w-[80%] lg:w-full border-b border-t-0 border-x-0 bg-[#f7faff] focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0 text-[15px] lg:text:lg"
                [(ngModel)]="itemName[i]"
                [readOnly]="viewOnly"
              />
            </span>
            <span
              class="flex lg:inline justify-between w-full lg:w-[15%] items-center"
            >
              <label class="inline lg:hidden text-[15px] text-gray-700"
                >Quantity</label
              >
              <input
                type="text"
                name="quantity"
                ngModel="quantity"
                class="w-[60%] lg:w-full border-b border-t-0 border-x-0 bg-[#f7faff] focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
                [(ngModel)]="quantity[i]"
                (input)="updateAmount(i)"
                [readOnly]="viewOnly"
              />
            </span>
            <span
              class="flex lg:inline justify-between w-full lg:w-[15%] items-center"
            >
              <label class="inline lg:hidden text-[15px] text-gray-700"
                >Rate</label
              >
              <input
                type="text"
                name="rate"
                ngModel="rate"
                class="w-[60%] lg:w-full border-b border-t-0 border-x-0 bg-[#f7faff] focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
                [(ngModel)]="rate[i]"
                (input)="updateAmount(i)"
                [readOnly]="viewOnly"
              />
            </span>
            <span
              class="flex lg:inline justify-between w-full lg:w-[15%] items-center"
            >
              <label class="inline lg:hidden text-[15px] text-gray-700"
                >Amount</label
              >
              <input
                type="text"
                name="amount"
                class="w-[60%] lg:w-full border-b border-t-0 border-x-0 bg-[#f7faff] focus:border-x-transparent focus:border-t-transparent focus:ring-0 pl-0"
                [value]="rate[i] * quantity[i] ? rate[i] * quantity[i] : ''"
                [readOnly]="viewOnly"
              />
            </span>
            <button
              *ngIf="!viewOnly"
              class="hidden lg:inline-block"
              (click)="onRemoveItem(i)"
            >
              <svg
                class="w-6 h-6 text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18 18 6m0 12L6 6"
                />
              </svg>
            </button>
            <div class="block lg:hidden text-left w-full">
              <button
                *ngIf="!viewOnly"
                class="border border-gray-500 rounded-[4px] border-dashed p-3 mt-6"
                (click)="onRemoveItem(i)"
              >
                Remove Item
              </button>
            </div>
          </div>
        </ng-container>
        <button
          *ngIf="!viewOnly"
          class="ml-4 mb-5 inline-flex items-center gap-1 border border-gray-500 rounded-[4px] border-dashed p-3 mt-6"
          (click)="onAddItem()"
        >
          <svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm11-4.2a1 1 0 1 0-2 0V11H7.8a1 1 0 1 0 0 2H11v3.2a1 1 0 1 0 2 0V13h3.2a1 1 0 1 0 0-2H13V7.8Z"
              clip-rule="evenodd"
            />
          </svg>
          Add More Items
        </button>
      </div>

      <div class="text-right p-4 mt-10">
        <h1
          class="font-bold text-3xl text-right border-y border-y-gray-300 inline-flex gap-20 py-2 text-gray-500"
        >
          <span>Total: </span>
          <span>{{ this.totalAmount }}</span>
        </h1>
      </div>
      <div class="text-center mt-12">
        <button
          *ngIf="!currentInvoice"
          type="button"
          class="px-5 py-2.5 text-md font-medium disabled:opacity-75 text-white bg-[#16579D] hover:bg-[#033360] disabled:bg-gray-400 disabled:hover:cursor-not-allowed focus:ring-4 focus:outline-none focus:ring-violet-300 rounded-lg text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
          (click)="onSubmit()"
        >
          Submit
        </button>
        <button
          *ngIf="currentInvoice && !viewOnly"
          type="button"
          class="px-5 py-2.5 text-md font-medium disabled:opacity-75 text-white bg-[#16579D] hover:bg-[#033360] disabled:bg-gray-400 disabled:hover:cursor-not-allowed focus:ring-4 focus:outline-none focus:ring-violet-300 rounded-lg text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
          (click)="onUpdate()"
        >
          Update
        </button>
      </div>
    </div>
  </div>
</div>
